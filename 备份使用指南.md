# jshERP å¤‡ä»½ç³»ç»Ÿå¿«é€Ÿä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ‰§è¡Œå®Œæ•´å¤‡ä»½
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x full_backup.sh

# æ‰§è¡Œå¤‡ä»½
./full_backup.sh

# æŸ¥çœ‹å¤‡ä»½ç»“æœ
ls -lh /backup/jshERP/
```

### 2. éªŒè¯å¤‡ä»½å®Œæ•´æ€§
```bash
# éªŒè¯æœ€æ–°å¤‡ä»½
./backup_verify.sh /backup/jshERP/jshERP_complete_backup_*.tar.gz

# æŸ¥çœ‹éªŒè¯æŠ¥å‘Š
cat /backup/jshERP/*/verification_report.txt
```

### 3. æ¢å¤ç³»ç»Ÿ
```bash
# å®Œæ•´æ¢å¤åˆ°æ–°ç¯å¢ƒ
./full_restore.sh /backup/jshERP/jshERP_complete_backup_20250613_143022.tar.gz

# æ¢å¤åˆ°æŒ‡å®šç›®å½•
./full_restore.sh /backup/jshERP/jshERP_complete_backup_20250613_143022.tar.gz /opt/jshERP
```

## ğŸ“‹ å¤‡ä»½æ–‡ä»¶è¯´æ˜

### å¤‡ä»½å†…å®¹æ¸…å•
- âœ… **æºä»£ç **ï¼šå®Œæ•´é¡¹ç›®ä»£ç  + é…ç½®ä¿®æ”¹
- âœ… **æ•°æ®åº“**ï¼šMySQL å®Œæ•´æ•°æ® + è¡¨ç»“æ„
- âœ… **Docker é•œåƒ**ï¼šæ‰€æœ‰ç›¸å…³å®¹å™¨é•œåƒ
- âœ… **Redis æ•°æ®**ï¼šç¼“å­˜æ•°æ® + é…ç½®ä¿¡æ¯
- âœ… **æ–‡æ¡£è„šæœ¬**ï¼šéƒ¨ç½²æ–‡æ¡£ + ç»´æŠ¤è„šæœ¬

### æ–‡ä»¶å¤§å°ä¼°ç®—
| ç»„ä»¶ | å¤§å°èŒƒå›´ | è¯´æ˜ |
|------|----------|------|
| å®Œæ•´å¤‡ä»½åŒ… | 1.1-1.6GB | å‹ç¼©åçš„æœ€ç»ˆæ–‡ä»¶ |
| æºä»£ç  | 50-100MB | é¡¹ç›®æºç å‹ç¼©åŒ… |
| æ•°æ®åº“ | 5-25MB | æ ¹æ®ä¸šåŠ¡æ•°æ®é‡ |
| Docker é•œåƒ | 1-1.5GB | å ç”¨æœ€å¤§ç©ºé—´ |
| Redis æ•°æ® | 1-5MB | ç¼“å­˜æ•°æ® |

## âš™ï¸ è‡ªåŠ¨åŒ–é…ç½®

### è®¾ç½®å®šæ—¶å¤‡ä»½
```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ æ¯æ—¥å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * /path/to/full_backup.sh >> /var/log/jshERP_backup.log 2>&1

# æ·»åŠ æ¯å‘¨éªŒè¯
0 3 * * 1 /path/to/backup_verify.sh /backup/jshERP/jshERP_complete_backup_*.tar.gz
```

### ç›‘æ§è„šæœ¬
```bash
# æ£€æŸ¥å¤‡ä»½çŠ¶æ€
#!/bin/bash
LATEST_BACKUP=$(ls -t /backup/jshERP/jshERP_complete_backup_*.tar.gz | head -1)
if [ -z "$LATEST_BACKUP" ]; then
    echo "è­¦å‘Šï¼šæœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶"
    exit 1
fi

# æ£€æŸ¥å¤‡ä»½æ—¶é—´ï¼ˆ24å°æ—¶å†…ï¼‰
if [ $(find /backup/jshERP -name "*.tar.gz" -mtime -1 | wc -l) -eq 0 ]; then
    echo "è­¦å‘Šï¼š24å°æ—¶å†…æ— æ–°å¤‡ä»½"
    exit 1
fi

echo "å¤‡ä»½çŠ¶æ€æ­£å¸¸"
```

## ğŸ”§ æ•…éšœå¤„ç†

### å¸¸è§é—®é¢˜è§£å†³

#### 1. å¤‡ä»½ç©ºé—´ä¸è¶³
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /backup

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
find /backup/jshERP -name "*.tar.gz" -mtime +7 -delete

# å‹ç¼©æ—§å¤‡ä»½
find /backup/jshERP -name "20*" -type d -mtime +3 -exec tar -czf {}.tar.gz {} \; -exec rm -rf {} \;
```

#### 2. å¤‡ä»½éªŒè¯å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
./backup_verify.sh /path/to/backup.tar.gz

# æ£€æŸ¥æ ¡éªŒå’Œ
cd /backup/jshERP/20250613_143022
md5sum -c backup_checksums.md5

# é‡æ–°ç”Ÿæˆæ ¡éªŒå’Œ
find . -type f -not -name "*.md5" -exec md5sum {} \; > backup_checksums.md5
```

#### 3. æ¢å¤å¤±è´¥
```bash
# æ£€æŸ¥ Docker ç¯å¢ƒ
docker --version
docker-compose --version

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep -E ':(3000|9999|3306|6379|80)\s'

# æ¸…ç†ç°æœ‰å®¹å™¨
docker-compose -f docker-compose.dev.yml down -v
docker system prune -f
```

### ç´§æ€¥æ¢å¤æµç¨‹

#### å®Œå…¨ç³»ç»Ÿæ•…éšœ
```bash
# 1. å‡†å¤‡æ–°ç¯å¢ƒ
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# 2. ä¸‹è½½å¤‡ä»½
# ä»äº‘å­˜å‚¨æˆ–å…¶ä»–ä½ç½®è·å–æœ€æ–°å¤‡ä»½

# 3. æ‰§è¡Œæ¢å¤
./full_restore.sh backup_file.tar.gz /opt/jshERP

# 4. éªŒè¯ç³»ç»Ÿ
curl http://localhost:3000
```

#### ä»…æ•°æ®åº“æ•…éšœ
```bash
# 1. åœæ­¢åº”ç”¨
docker-compose stop jsherp-backend-dev

# 2. æ¢å¤æ•°æ®åº“
docker exec -i jsherp-mysql-dev mysql -u root -p123456 jsh_erp < backup/database/jsh_erp_full_*.sql

# 3. é‡å¯åº”ç”¨
docker-compose start jsherp-backend-dev
```

## ğŸ“Š å¤‡ä»½ç›‘æ§

### å¥åº·æ£€æŸ¥
```bash
# æ¯æ—¥å¥åº·æ£€æŸ¥è„šæœ¬
#!/bin/bash
echo "=== jshERP å¤‡ä»½å¥åº·æ£€æŸ¥ ==="

# 1. æ£€æŸ¥æœ€æ–°å¤‡ä»½
LATEST=$(ls -t /backup/jshERP/*.tar.gz 2>/dev/null | head -1)
if [ -n "$LATEST" ]; then
    echo "âœ… æœ€æ–°å¤‡ä»½: $(basename "$LATEST")"
    echo "   å¤§å°: $(du -h "$LATEST" | cut -f1)"
    echo "   æ—¶é—´: $(stat -f%Sm "$LATEST" 2>/dev/null || stat -c%y "$LATEST")"
else
    echo "âŒ æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶"
fi

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
USAGE=$(df /backup | awk 'NR==2 {print $5}' | sed 's/%//')
if [ "$USAGE" -lt 80 ]; then
    echo "âœ… ç£ç›˜ç©ºé—´å……è¶³: ${USAGE}%"
else
    echo "âš ï¸  ç£ç›˜ç©ºé—´ä¸è¶³: ${USAGE}%"
fi

# 3. æ£€æŸ¥å¤‡ä»½é¢‘ç‡
RECENT=$(find /backup/jshERP -name "*.tar.gz" -mtime -1 | wc -l)
if [ "$RECENT" -gt 0 ]; then
    echo "âœ… 24å°æ—¶å†…æœ‰æ–°å¤‡ä»½"
else
    echo "âš ï¸  24å°æ—¶å†…æ— æ–°å¤‡ä»½"
fi
```

### å‘Šè­¦é…ç½®
```bash
# é‚®ä»¶å‘Šè­¦ç¤ºä¾‹
send_alert() {
    local subject="$1"
    local message="$2"
    echo "$message" | mail -s "jshERP å¤‡ä»½å‘Šè­¦: $subject" admin@company.com
}

# ä¼ä¸šå¾®ä¿¡å‘Šè­¦ç¤ºä¾‹
send_wechat_alert() {
    local message="$1"
    curl -X POST "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY" \
         -H "Content-Type: application/json" \
         -d "{\"msgtype\":\"text\",\"text\":{\"content\":\"$message\"}}"
}
```

## ğŸŒ äº‘ç«¯å¤‡ä»½

### ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSS
```bash
# å®‰è£… ossutil
wget http://gosspublic.alicdn.com/ossutil/1.7.0/ossutil64
chmod +x ossutil64

# é…ç½®
./ossutil64 config

# è‡ªåŠ¨ä¸Šä¼ è„šæœ¬
#!/bin/bash
BACKUP_FILE="/backup/jshERP/jshERP_complete_backup_$(date +%Y%m%d)*.tar.gz"
if [ -f $BACKUP_FILE ]; then
    ./ossutil64 cp $BACKUP_FILE oss://your-bucket/jshERP/$(date +%Y/%m)/
    echo "äº‘ç«¯å¤‡ä»½å®Œæˆ"
fi
```

### ä¸Šä¼ åˆ° AWS S3
```bash
# å®‰è£… AWS CLI
pip install awscli

# é…ç½®
aws configure

# è‡ªåŠ¨ä¸Šä¼ è„šæœ¬
#!/bin/bash
BACKUP_FILE="/backup/jshERP/jshERP_complete_backup_$(date +%Y%m%d)*.tar.gz"
if [ -f $BACKUP_FILE ]; then
    aws s3 cp $BACKUP_FILE s3://your-bucket/jshERP/$(date +%Y/%m)/
    echo "S3 å¤‡ä»½å®Œæˆ"
fi
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. å¤‡ä»½ç­–ç•¥
- **é¢‘ç‡**ï¼šæ¯æ—¥è‡ªåŠ¨å¤‡ä»½
- **ä¿ç•™**ï¼šæœ¬åœ° 7 å¤©ï¼Œäº‘ç«¯ 30 å¤©
- **éªŒè¯**ï¼šæ¯å‘¨éªŒè¯å¤‡ä»½å®Œæ•´æ€§
- **æµ‹è¯•**ï¼šæ¯æœˆè¿›è¡Œæ¢å¤æµ‹è¯•

### 2. å®‰å…¨å»ºè®®
- å¤‡ä»½æ–‡ä»¶åŠ å¯†å­˜å‚¨
- é™åˆ¶å¤‡ä»½æ–‡ä»¶è®¿é—®æƒé™
- å®šæœŸæ›´æ–°å¤‡ä»½è„šæœ¬
- è®°å½•å¤‡ä»½æ“ä½œæ—¥å¿—

### 3. æ€§èƒ½ä¼˜åŒ–
- åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œå¤‡ä»½
- ä½¿ç”¨å¢é‡å¤‡ä»½å‡å°‘æ—¶é—´
- å¹¶è¡Œå¤„ç†æé«˜æ•ˆç‡
- å‹ç¼©å¤‡ä»½èŠ‚çœç©ºé—´

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **æ–‡æ¡£é—®é¢˜**ï¼šæŸ¥çœ‹ `jshERPå¤‡ä»½æ–¹æ¡ˆ.md`
- **è„šæœ¬é—®é¢˜**ï¼šæ£€æŸ¥æ—¥å¿—æ–‡ä»¶ `/backup/jshERP/*/backup.log`
- **æ¢å¤é—®é¢˜**ï¼šå‚è€ƒ `æ€»ç»“æ–‡æ¡£.md` æ•…éšœæ’æŸ¥éƒ¨åˆ†

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -f /backup/jshERP/*/backup.log

# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# éªŒè¯æ•°æ®åº“è¿æ¥
docker exec jsherp-mysql-dev mysql -u root -p123456 -e "SELECT 1"

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /backup
```

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°**: 2025å¹´6æœˆ13æ—¥  
**é€‚ç”¨**: jshERP æœ€æ–°ç‰ˆæœ¬
